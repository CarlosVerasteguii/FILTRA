# Story 1.4: Windows 11 Readiness

## Status
Draft

## Story
**As a** user on Windows 11,
**I want** encoding and path handling to just work,
**so that** inputs render correctly and examples run as-is.

## Acceptance Criteria
1. File I/O uses utf-8-sig first, cp1252 fallback; normalized newlines in output.
2. All README examples quote paths; CLI correctly handles spaces in file paths.
3. Installation and run steps verified on Windows 11 PowerShell.

## Tasks / Subtasks
- [ ] Harden CLI-managed file I/O to prefer `utf-8-sig` with `cp1252` fallback and normalize newline output across resume/JD ingestion and reporting (AC: 1) [Source: architecture/components.md#cli-command-layer][Source: architecture/components.md#configuration--persistence-layer][Source: architecture/tech-stack.md#data-models]
  - [ ] Update the job description loader and CLI option parsing to apply the encoding fallback, surfacing actionable errors when neither codec succeeds (AC: 1) [Source: architecture/security.md#input-validation][Source: architecture/components.md#cli-command-layer]
  - [ ] Normalize resume and report text newlines before emitting through the reporting layer so Windows outputs display consistently (AC: 1) [Source: architecture/components.md#pdf-processing-module][Source: architecture/components.md#report-composition-layer]
- [ ] Ensure CLI accepts Windows paths with spaces and quotes them in help/logging without breaking Typer UX (AC: 2) [Source: architecture/coding-standards.md#core-standards][Source: architecture/security.md#input-validation]
  - [ ] Exercise CLI argument parsing with spaced paths in unit tests to confirm sanitized, absolute `Path` usage (AC: 2) [Source: architecture/test-strategy-and-standards.md#unit-tests][Source: architecture/source-tree.md#source-tree]
  - [ ] Propagate normalized path displays into diagnostics/report summaries while avoiding leaking sensitive directories (AC: 2) [Source: architecture/components.md#diagnostics--warmup-service][Source: architecture/security.md#data-protection]
- [ ] Refresh README and scripts with PowerShell-ready examples that quote paths and describe Windows 11 setup (AC: 2,3) [Source: architecture/coding-standards.md#core-standards][Source: architecture/infrastructure-and-deployment.md#deployment-strategy]
  - [ ] Update existing CLI usage snippets to demonstrate escaped spaces and reference default model cache location (AC: 2) [Source: architecture/tech-stack.md#technology-stack-table][Source: architecture/infrastructure-and-deployment.md#environments]
  - [ ] Extend onboarding steps with Windows PowerShell verification notes covering warm-up and run commands (AC: 3) [Source: architecture/infrastructure-and-deployment.md#environment-promotion-flow][Source: architecture/high-level-architecture.md#technical-summary]
- [ ] Validate Windows 11 execution through automated coverage and manual checklist (AC: 3) [Source: architecture/test-strategy-and-standards.md#integration-tests][Source: architecture/infrastructure-and-deployment.md#environments]
  - [ ] Add integration test invoking CLI with spaced paths and verifying normalized newlines in generated outputs (AC: 1,2) [Source: architecture/test-strategy-and-standards.md#integration-tests][Source: architecture/components.md#report-composition-layer]
  - [ ] Document the PowerShell session verification (install, warm-up, sample run) in `docs/qa/windows-11-runbook.md` to confirm AC3 (AC: 3) [Source: architecture/test-strategy-and-standards.md#continuous-testing][Source: architecture/infrastructure-and-deployment.md#deployment-strategy]

## Dev Notes
### Previous Story Insights
- Warm-up diagnostics already confirm environment readiness and should be rerun after encoding/path changes to ensure the CLI remains Windows-friendly. [Source: architecture/components.md#diagnostics--warmup-service]

### Data Models
- `ResumeDocument` stores the normalized resume text derived from the user-provided PDF path, so newline normalization must occur before feeding downstream consumers. [Source: architecture/tech-stack.md#data-models]
- `JobDescription` holds cleaned JD text from the CLI-supplied path, making encoding fallback essential to preserve report content. [Source: architecture/tech-stack.md#data-models]

### API Specifications
- No new external APIs introduced; Windows readiness stays within the existing CLI scope per decision to keep capabilities in-process. [Source: architecture/high-level-architecture.md#service-architecture]

### Component Specifications
- The CLI command layer reads CLI inputs and hands them to orchestration, so it must enforce safe path handling and encoding fallbacks. [Source: architecture/components.md#cli-command-layer]
- Configuration & persistence utilities already operate with Windows-aware paths, so reuse those helpers when adjusting file I/O. [Source: architecture/components.md#configuration--persistence-layer]
- Report composition is responsible for the final terminal rendering; ensure newline normalization happens before output. [Source: architecture/components.md#report-composition-layer]

### File Locations
- CLI entry points and argument parsing live in `filtra/cli.py`, while supporting utilities for encoding/path helpers belong under `filtra/utils/`. [Source: architecture/source-tree.md#source-tree]
- Documentation updates should touch `README.md` and Windows helper scripts inside `scripts/`. [Source: architecture/source-tree.md#source-tree]

### Testing Requirements
- Add unit tests under `tests/test_cli.py` or adjacent modules using pytest and pytest-mock to cover encoding and path scenarios. [Source: architecture/test-strategy-and-standards.md#unit-tests]
- Exercise CLI flows with spaced paths and newline assertions through integration tests in `tests/integration/`, aligned with Windows coverage goals. [Source: architecture/test-strategy-and-standards.md#integration-tests]
- Capture Windows verification steps in CI documentation so the matrix run stays meaningful. [Source: architecture/test-strategy-and-standards.md#continuous-testing]
- Add unit tests covering successful fallback from `utf-8-sig` to `cp1252`, ensuring resume/JD ingestion completes when UTF-8 decoding fails. [Source: architecture/test-strategy-and-standards.md#unit-tests][Source: architecture/components.md#cli-command-layer]
- Add negative-path coverage that surfaces actionable errors when both encodings fail so CLI messaging matches validation standards. [Source: architecture/test-strategy-and-standards.md#unit-tests][Source: architecture/security.md#input-validation]

### Technical Constraints
- Typer CLI interactions must remain PowerShell-friendly as mandated by coding standards. [Source: architecture/coding-standards.md#core-standards]
- Windows behaviour can drift without verification, so the story must reinforce Windows 11 checks. [Source: architecture/coding-standards.md#risk-review]
- Windows 11 laptops are the primary development environment, so validation steps should assume that platform. [Source: architecture/infrastructure-and-deployment.md#environments]

### Project Structure Notes
- Follow the documented source tree when editing CLI, utils, or documentation files; do not introduce new top-level packages. [Source: architecture/source-tree.md#source-tree]
- No dedicated unified project structure doc exists; continue to rely on `source-tree.md` for placement guidance. [Source: architecture/source-tree.md#source-tree]

### Testing
- Follow pytest-based workflow with >=85% coverage while exercising Windows-specific code paths. [Source: architecture/test-strategy-and-standards.md#testing-philosophy]
- Validate encoding fallback success and failure behaviours across unit and integration suites, mirroring CLI error messaging. [Source: architecture/test-strategy-and-standards.md#unit-tests][Source: architecture/components.md#cli-command-layer]
- Record manual Windows 11 verification outcomes (install, warm-up, sample run) in `docs/qa/windows-11-runbook.md`. [Source: architecture/test-strategy-and-standards.md#continuous-testing]

## Change Log
| Date       | Version | Description     | Author |
| ---------- | ------- | --------------- | ------ |
| 2025-09-26 | v0.1    | Initial draft   | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
- Not yet reviewed.
