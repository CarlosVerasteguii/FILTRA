# Story 2.4b: CLI Reporting Modes

## Status
Approved

## Story
**As a** CLI user,
**I want** quiet and wide modes that align with the reporting specification,
**so that** I can control verbosity and layout without losing the final entities summary.

## Acceptance Criteria
1. Add a `--wide` flag surfaced in CLI help and warm-up output that toggles additional columns in the report renderer.
2. Quiet mode suppresses progress logs but still prints the final entities section unless an error occurs.
3. CLI help and documentation describe quiet and wide behavior with PowerShell-friendly examples and stay synchronized between Typer help, warm-up output, and README snippets.
4. Automated tests validate quiet output, wide column rendering, and help text updates while remaining resilient to layout adjustments (avoid brittle width assertions).

## Tasks / Subtasks
- [ ] Wire quiet and wide options through CLI entry points (AC: 1,2,3) [Source: architecture/components.md#cli-command-layer][Source: architecture/core-workflows.md#entity-processing-flow]
  - [ ] Add a `--wide` Typer option on the `run` subcommand and ensure quiet mode still routes the final entities section to stdout. (AC: 1,2)
  - [ ] Update CLI help text and warm-up messaging to explain quiet and wide behaviors with PowerShell-friendly usage examples. (AC: 1,3)
- [ ] Propagate quiet/wide toggles into reporting orchestration (AC: 1,2) [Source: architecture/core-workflows.md#entity-processing-flow][Source: architecture/components.md#report-composition-layer][Source: docs/prd/epic-2-core-extraction.md#story-24-entities-report-section]
  - [ ] Extend the execution orchestrator to include quiet and wide flags in the report envelope/render options handoff. (AC: 1,2)
  - [ ] Adjust reporting composer/renderer helpers so wide mode adds sources and default mode remains near 100 columns while still ASCII-only. (AC: 1) [Source: docs/prd/epic-2-core-extraction.md#story-24-entities-report-section]
- [ ] Refresh documentation for CLI modes (AC: 3) [Source: architecture/components.md#cli-command-layer][Source: prd/user-interface-design-goals-cli-ux.md#windows-11-considerations]
  - [ ] Document quiet and wide behavior in CLI help, README snippets, and warm-up output to highlight Windows Terminal usage. (AC: 3)
- [ ] Expand automated coverage for quiet and wide behavior (AC: 4) [Source: architecture/test-strategy-and-standards.md#quiet-and-wide-modes][Source: architecture/coding-standards.md#core-standards]
  - [ ] Add CLI integration tests that assert quiet suppresses progress logs yet keeps the entities summary and that wide renders the sources column. (AC: 4)
  - [ ] Add unit coverage for any formatting helpers that govern quiet/wide layout logic. (AC: 4)

## Project Structure Notes
- CLI entry lives in `filtra/cli.py`, reporting helpers in `filtra/reporting/`, and CLI tests under `tests/test_cli.py` with additional reporting tests in `tests/reporting/`. This story aligns with the existing source tree; no conflicts detected. [Source: architecture/source-tree.md#source-tree]

## Dev Notes
### Previous Story Insights
- Reporting depends on canonical entities from Story 2.4a, and the architecture expects the CLI to pass quiet and wide toggles so the report composer can adjust layout while always emitting the final entities section. [Source: architecture/core-workflows.md#entity-processing-flow][Source: architecture/components.md#report-composition-layer]

### Data Models
- `EvaluationRun` captures CLI flags (including quiet and future width toggles) for traceability, ensuring render settings propagate consistently. [Source: architecture/tech-stack.md#evaluationrun]
- `ReportEnvelope.render_options` stores quiet and wide flags so the renderer can expand columns or suppress progress output deterministically. [Source: architecture/tech-stack.md#reportenvelope]

### API Specifications
- The CLI command layer exposes `run` and `warm_up` interfaces that must parse quiet/wide flags and forward them during execution. [Source: architecture/components.md#cli-command-layer]

### Component Specifications
- The Report Composition Layer merges canonical entities with CLI render options, expanding tables in wide mode while maintaining ASCII formatting. [Source: architecture/components.md#report-composition-layer]
- The CLI command layer is responsible for enforcing quiet output discipline while still printing the final report section. [Source: architecture/components.md#cli-command-layer]

### File Locations
- CLI options are defined in `filtra/cli.py`, orchestrator wiring in `filtra/orchestration/runner.py`, and reporting adjustments in `filtra/reporting/composer.py` and `filtra/reporting/renderer.py`; related tests live in `tests/test_cli.py` and `tests/reporting/test_entities_section.py`. [Source: architecture/source-tree.md#source-tree]

### Testing Requirements
- Tests must mirror package structure, using pytest-based unit tests and CLI integration coverage to validate quiet/wide behavior and deterministic ordering. [Source: architecture/test-strategy-and-standards.md#quiet-and-wide-modes]
- Reporting unit tests should exercise width-aware helpers to keep default output near 100 columns and validate wide-mode formatting, empty states, and localization fallbacks. [Source: architecture/test-strategy-and-standards.md#quiet-and-wide-modes]
- Maintain >=85% coverage and follow pytest conventions when adding new suites. [Source: architecture/test-strategy-and-standards.md#testing-philosophy]

### Technical Constraints
- Only the reporting layer may write to stdout/stderr; other modules must return data or raise structured errors, so quiet mode must explicitly route warnings/errors to stderr even when quiet mode suppresses progress logs. [Source: architecture/coding-standards.md#critical-rules]
- Quiet runs must still emit the final entities summary, and wide mode must expand columns while keeping the default layout ASCII-only and near 100 columns as defined in the reporting specification. [Source: architecture/components.md#report-composition-layer][Source: docs/prd/epic-2-core-extraction.md#story-24-entities-report-section]

## Testing
- Place CLI integration tests under `tests/test_cli.py` and reporting-specific tests under `tests/reporting/`, exercising quiet suppression, wide layout, and help text updates. [Source: architecture/source-tree.md#source-tree][Source: architecture/test-strategy-and-standards.md#quiet-and-wide-modes]
- Use pytest with fixtures/mocks to validate logging behavior while maintaining the >=85% coverage goal. [Source: architecture/test-strategy-and-standards.md#testing-philosophy]

## Change Log
| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
